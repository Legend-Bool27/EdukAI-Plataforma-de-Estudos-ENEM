<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdukAI - Plataforma de Estudos ENEM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            /* Paleta Padrão - Roxo/Índigo */
            --bg-primary: #f0f2f5;
            --bg-secondary: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-color: #4f46e5;
            --accent-hover: #4338ca;
            --card-bg: #ffffff;
            --border-color: #e9ecef;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --chat-user: #4f46e5;
            --chat-bot: #f1f5f9;
            
            /* Tema Claro - Cores Adicionais */
            --badge-gold: #fbbf24;
            --badge-silver: #94a3b8;
            --badge-bronze: #b45309;
            --badge-platinum: #a78bfa;
            --rank-1: #ffd700;
            --rank-2: #c0c0c0;
            --rank-3: #cd7f32;
            --online-status: #10b981;
            --offline-status: #94a3b8;
            --message-bg: #f8fafc;
            --hover-bg: #e2e8f0;
            --gradient-start: #4f46e5;
            --gradient-end: #7c3aed;
        }

        [data-theme="dark"] {
            /* Tema Escuro - Paleta Principal */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --accent-color: #6366f1;
            --accent-hover: #818cf8;
            --card-bg: #334155;
            --border-color: #475569;
            --shadow: 0 10px 30px rgba(0,0,0,0.5);
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --info: #2563eb;
            --chat-bot: #334155;
            
            /* Tema Escuro - Cores Adicionais */
            --badge-gold: #fbbf24;
            --badge-silver: #64748b;
            --badge-bronze: #92400e;
            --badge-platinum: #8b5cf6;
            --rank-1: #fbbf24;
            --rank-2: #94a3b8;
            --rank-3: #b45309;
            --online-status: #059669;
            --offline-status: #475569;
            --message-bg: #1e293b;
            --hover-bg: #2d3a4f;
        }

        /* Paleta 2 - Verde/Esmeralda */
        [data-palette="green"] {
            --accent-color: #10b981;
            --accent-hover: #059669;
            --chat-user: #10b981;
            --gradient-start: #10b981;
            --gradient-end: #047857;
            --badge-platinum: #34d399;
        }

        [data-theme="dark"][data-palette="green"] {
            --accent-color: #34d399;
            --accent-hover: #10b981;
            --gradient-start: #10b981;
            --gradient-end: #047857;
        }

        /* Paleta 3 - Azul/Oceano */
        [data-palette="blue"] {
            --accent-color: #3b82f6;
            --accent-hover: #2563eb;
            --chat-user: #3b82f6;
            --gradient-start: #3b82f6;
            --gradient-end: #1d4ed8;
            --badge-platinum: #60a5fa;
        }

        [data-theme="dark"][data-palette="blue"] {
            --accent-color: #60a5fa;
            --accent-hover: #3b82f6;
            --gradient-start: #3b82f6;
            --gradient-end: #1e3a8a;
        }

        /* Paleta 4 - Vermelho/Coral */
        [data-palette="red"] {
            --accent-color: #ef4444;
            --accent-hover: #dc2626;
            --chat-user: #ef4444;
            --gradient-start: #ef4444;
            --gradient-end: #b91c1c;
            --badge-platinum: #f87171;
        }

        [data-theme="dark"][data-palette="red"] {
            --accent-color: #f87171;
            --accent-hover: #ef4444;
            --gradient-start: #ef4444;
            --gradient-end: #991b1b;
        }

        /* Paleta 5 - Laranja/Âmbar */
        [data-palette="orange"] {
            --accent-color: #f97316;
            --accent-hover: #ea580c;
            --chat-user: #f97316;
            --gradient-start: #f97316;
            --gradient-end: #c2410c;
            --badge-platinum: #fb923c;
        }

        [data-theme="dark"][data-palette="orange"] {
            --accent-color: #fb923c;
            --accent-hover: #f97316;
            --gradient-start: #f97316;
            --gradient-end: #9a3412;
        }

        /* Paleta 6 - Rosa/Roxo */
        [data-palette="pink"] {
            --accent-color: #ec4899;
            --accent-hover: #db2777;
            --chat-user: #ec4899;
            --gradient-start: #ec4899;
            --gradient-end: #9d174d;
            --badge-platinum: #f472b6;
        }

        [data-theme="dark"][data-palette="pink"] {
            --accent-color: #f472b6;
            --accent-hover: #ec4899;
            --gradient-start: #ec4899;
            --gradient-end: #831843;
        }

        /* Paleta 7 - Roxo Escuro */
        [data-palette="purple"] {
            --accent-color: #8b5cf6;
            --accent-hover: #7c3aed;
            --chat-user: #8b5cf6;
            --gradient-start: #8b5cf6;
            --gradient-end: #5b21b6;
            --badge-platinum: #a78bfa;
        }

        [data-theme="dark"][data-palette="purple"] {
            --accent-color: #a78bfa;
            --accent-hover: #8b5cf6;
            --gradient-start: #8b5cf6;
            --gradient-end: #4c1d95;
        }

        /* Paleta 8 - Amarelo/Dourado */
        [data-palette="yellow"] {
            --accent-color: #eab308;
            --accent-hover: #ca8a04;
            --chat-user: #eab308;
            --gradient-start: #eab308;
            --gradient-end: #854d0e;
            --badge-platinum: #facc15;
        }

        [data-theme="dark"][data-palette="yellow"] {
            --accent-color: #facc15;
            --accent-hover: #eab308;
            --gradient-start: #eab308;
            --gradient-end: #713f12;
        }

        /* Paleta 9 - Ciano/Turquesa */
        [data-palette="cyan"] {
            --accent-color: #06b6d4;
            --accent-hover: #0891b2;
            --chat-user: #06b6d4;
            --gradient-start: #06b6d4;
            --gradient-end: #155e75;
            --badge-platinum: #22d3ee;
        }

        [data-theme="dark"][data-palette="cyan"] {
            --accent-color: #22d3ee;
            --accent-hover: #06b6d4;
            --gradient-start: #06b6d4;
            --gradient-end: #164e63;
        }

        /* Paleta 10 - Grafite/Elegante */
        [data-palette="graphite"] {
            --accent-color: #334155;
            --accent-hover: #1e293b;
            --chat-user: #334155;
            --gradient-start: #334155;
            --gradient-end: #0f172a;
            --badge-platinum: #64748b;
            --border-color: #475569;
        }

        [data-theme="dark"][data-palette="graphite"] {
            --accent-color: #64748b;
            --accent-hover: #475569;
            --gradient-start: #475569;
            --gradient-end: #0f172a;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        /* Seletor de Paleta */
        .palette-selector {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 1500;
            background: var(--bg-secondary);
            border-radius: 30px;
            padding: 15px;
            box-shadow: var(--shadow);
            border: 2px solid var(--border-color);
            width: 250px;
            animation: slideInLeft 0.3s ease;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .palette-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        .palette-header h4 {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .palette-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 16px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .palette-toggle:hover {
            background: var(--hover-bg);
        }

        .palette-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .palette-option {
            width: 35px;
            height: 35px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .palette-option:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .palette-option.active {
            border-color: var(--text-primary);
            transform: scale(1.1);
        }

        .palette-option.default {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
        }
        .palette-option.green {
            background: linear-gradient(135deg, #10b981, #047857);
        }
        .palette-option.blue {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        .palette-option.red {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
        }
        .palette-option.orange {
            background: linear-gradient(135deg, #f97316, #c2410c);
        }
        .palette-option.pink {
            background: linear-gradient(135deg, #ec4899, #9d174d);
        }
        .palette-option.purple {
            background: linear-gradient(135deg, #8b5cf6, #5b21b6);
        }
        .palette-option.yellow {
            background: linear-gradient(135deg, #eab308, #854d0e);
        }
        .palette-option.cyan {
            background: linear-gradient(135deg, #06b6d4, #155e75);
        }
        .palette-option.graphite {
            background: linear-gradient(135deg, #334155, #0f172a);
        }

        .palette-minimized {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 1500;
            background: var(--accent-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            border: 2px solid var(--border-color);
            display: none;
        }

        .palette-minimized:hover {
            transform: rotate(90deg);
        }

        /* Tela de Login */
        .auth-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 2000;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .auth-container.hidden {
            transform: translateY(-100%);
        }

        .auth-box {
            background: white;
            padding: 50px 40px;
            border-radius: 30px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 480px;
            animation: fadeInUp 0.6s ease;
            transform-origin: center;
        }

        .auth-logo {
            text-align: center;
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: #f1f5f9;
            padding: 5px;
            border-radius: 50px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 50px;
        }

        .auth-tab.active {
            background: white;
            color: var(--accent-color);
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.2);
        }

        .auth-form {
            display: none;
            animation: slideIn 0.3s ease;
        }

        .auth-form.active {
            display: block;
        }

        .auth-form h2 {
            color: #1e293b;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .auth-form p {
            color: #64748b;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #1e293b;
            font-weight: 500;
        }

        .input-group input, 
        .input-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .auth-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Header Principal */
        .main-header {
            background: var(--bg-secondary);
            box-shadow: var(--shadow);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
            height: 80px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 32px;
            font-weight: bold;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 8px 20px 8px 12px;
            background: var(--bg-primary);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .user-info:hover {
            border-color: var(--accent-color);
            transform: scale(1.02);
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
        }

        .user-details {
            line-height: 1.4;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
        }

        .user-id {
            font-size: 11px;
            opacity: 0.7;
        }

        .theme-toggle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: var(--bg-primary);
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .theme-toggle:hover {
            border-color: var(--accent-color);
            transform: rotate(45deg);
        }

        /* Menu de Navegação */
        .nav-menu {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            position: fixed;
            width: 100%;
            top: 80px;
            z-index: 900;
            backdrop-filter: blur(10px);
        }

        .nav-menu ul {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
            list-style: none;
            display: flex;
            gap: 5px;
            height: 60px;
            align-items: center;
        }

        .nav-menu a {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 8px 20px;
            border-radius: 25px;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-menu a:hover,
        .nav-menu a.active {
            background: var(--accent-color);
            color: white;
        }

        /* Conteúdo Principal */
        .main-content {
            max-width: 1400px;
            margin: 180px auto 40px;
            padding: 0 30px;
        }

        /* Cards de Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Seção de Perfil e Amigos */
        .profile-section {
            background: var(--bg-secondary);
            border-radius: 30px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: none;
        }

        .profile-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .profile-header {
            display: flex;
            gap: 40px;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid var(--border-color);
        }

        .profile-avatar-large {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            font-weight: bold;
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }

        .profile-info h2 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .profile-badges {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .badge {
            background: var(--bg-primary);
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .badge.gold {
            background: var(--badge-gold);
            color: #000;
        }
        
        .badge.silver {
            background: var(--badge-silver);
            color: #000;
        }
        
        .badge.bronze {
            background: var(--badge-bronze);
            color: #fff;
        }
        
        .badge.platinum {
            background: var(--badge-platinum);
            color: #fff;
        }

        .profile-form {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--accent-color);
            outline: none;
        }

        /* Seção de Amigos */
        .friends-container {
            background: var(--bg-secondary);
            border-radius: 30px;
            padding: 40px;
            box-shadow: var(--shadow);
            display: none;
        }

        .friends-container.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .friends-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .friends-tabs {
            display: flex;
            gap: 10px;
            background: var(--bg-primary);
            padding: 5px;
            border-radius: 50px;
        }

        .friend-tab {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .friend-tab.active {
            background: var(--accent-color);
            color: white;
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
        }

        .friend-search {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .friend-search input {
            flex: 1;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 16px;
        }

        .friend-search input:focus {
            border-color: var(--accent-color);
            outline: none;
        }

        .friend-search button {
            padding: 0 30px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .friend-search button:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        .friends-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .friend-card {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: var(--bg-primary);
            border-radius: 20px;
            transition: all 0.3s;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .friend-card:hover {
            border-color: var(--accent-color);
            transform: translateX(5px);
        }

        .friend-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
            position: relative;
        }

        .friend-avatar.online::after {
            content: '';
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 12px;
            height: 12px;
            background: var(--online-status);
            border-radius: 50%;
            border: 2px solid var(--bg-primary);
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .friend-status {
            font-size: 13px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .friend-points {
            background: var(--bg-secondary);
            padding: 8px 15px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-color);
        }

        .friend-actions {
            display: flex;
            gap: 10px;
        }

        .friend-action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .friend-action-btn.accept {
            background: var(--success);
            color: white;
        }

        .friend-action-btn.reject {
            background: var(--danger);
            color: white;
        }

        .friend-action-btn.message {
            background: var(--accent-color);
            color: white;
        }

        /* Chat Privado */
        .private-chat {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 350px;
            height: 500px;
            background: var(--bg-secondary);
            border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s;
            z-index: 900;
            border: 2px solid var(--border-color);
            display: none;
        }

        .private-chat.show {
            display: flex;
        }

        .private-chat-header {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .private-chat-header h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
        }

        .private-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: var(--bg-secondary);
        }

        .private-message {
            max-width: 85%;
            animation: messageSlide 0.3s ease;
        }

        .private-message.sent {
            align-self: flex-end;
        }

        .private-message.received {
            align-self: flex-start;
        }

        .private-message-content {
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 14px;
            line-height: 1.4;
            background: var(--message-bg);
            color: var(--text-primary);
        }

        .private-message.sent .private-message-content {
            background: var(--accent-color);
            color: white;
        }

        .private-chat-input {
            display: flex;
            gap: 10px;
            padding: 15px;
            border-top: 2px solid var(--border-color);
        }

        .private-chat-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .private-chat-input input:focus {
            border-color: var(--accent-color);
            outline: none;
        }

        .private-chat-input button {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            background: var(--accent-color);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .private-chat-input button:hover {
            transform: scale(1.1);
        }

        /* Ranking */
        .ranking-container {
            background: var(--bg-secondary);
            border-radius: 30px;
            padding: 40px;
            box-shadow: var(--shadow);
            display: none;
        }

        .ranking-container.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 30px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 15px 20px;
            background: var(--bg-primary);
            border-radius: 15px;
            transition: all 0.3s;
        }

        .ranking-item:hover {
            transform: translateX(5px);
            background: var(--hover-bg);
        }

        .ranking-item.top-1 {
            border-left: 5px solid var(--rank-1);
        }

        .ranking-item.top-2 {
            border-left: 5px solid var(--rank-2);
        }

        .ranking-item.top-3 {
            border-left: 5px solid var(--rank-3);
        }

        .ranking-position {
            font-size: 20px;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }

        .ranking-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-name {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .ranking-points {
            font-size: 14px;
            color: var(--accent-color);
            font-weight: 600;
        }

        .ranking-badges {
            display: flex;
            gap: 5px;
        }

        .ranking-badge {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            background: var(--bg-secondary);
        }

        /* Badges Collection */
        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .badge-card {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .badge-card:hover {
            border-color: var(--accent-color);
            transform: translateY(-5px);
        }

        .badge-card.unlocked {
            background: linear-gradient(135deg, var(--success)20, transparent);
            border-color: var(--success);
        }

        .badge-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .badge-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .badge-description {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Matérias */
        .subjects-container {
            background: var(--bg-secondary);
            border-radius: 30px;
            padding: 40px;
            box-shadow: var(--shadow);
            display: none;
        }

        .subjects-container.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .subjects-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .year-tabs {
            display: flex;
            gap: 10px;
            background: var(--bg-primary);
            padding: 5px;
            border-radius: 50px;
        }

        .year-tab {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .year-tab.active {
            background: var(--accent-color);
            color: white;
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
        }

        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .subject-card {
            background: var(--bg-primary);
            border-radius: 20px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .subject-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
            box-shadow: 0 20px 30px rgba(79, 70, 229, 0.2);
        }

        .subject-card.completed {
            background: linear-gradient(135deg, #10b98120, #05966920);
            border-color: #10b981;
        }

        .subject-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .subject-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .subject-progress {
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            border-radius: 4px;
            transition: width 0.3s;
        }

        .subject-status {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .completed-badge {
            color: var(--success);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Conteúdo da Matéria */
        .subject-content {
            background: var(--bg-primary);
            border-radius: 20px;
            padding: 40px;
            margin-top: 30px;
            border: 2px solid var(--border-color);
        }

        .lesson-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .lesson-title {
            font-size: 28px;
            color: var(--accent-color);
        }

        .lesson-text {
            line-height: 1.8;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .lesson-text h4 {
            color: var(--text-primary);
            margin: 30px 0 15px;
            font-size: 22px;
        }

        .lesson-text p {
            margin-bottom: 15px;
        }

        .lesson-text ul {
            margin: 15px 0 15px 30px;
        }

        .lesson-text li {
            margin-bottom: 8px;
        }

        .complete-lesson-btn {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .complete-lesson-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }

        .complete-lesson-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Spotify Player */
        .spotify-player {
            background: var(--bg-primary);
            border-radius: 20px;
            padding: 25px;
            margin-top: 30px;
        }

        .spotify-player h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .playlist-select {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .playlist-select:focus {
            border-color: var(--accent-color);
            outline: none;
        }

        .spotify-frame {
            border-radius: 16px;
            box-shadow: var(--shadow);
            width: 100%;
            height: 152px;
            border: none;
        }

        /* Chat DeepSeek */
        .chat-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 400px;
            height: 600px;
            background: var(--bg-secondary);
            border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s;
            z-index: 800;
            border: 2px solid var(--border-color);
        }

        .chat-container.minimized {
            height: 70px;
            width: 250px;
        }

        .chat-header {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .chat-header h3 {
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-controls {
            display: flex;
            gap: 10px;
        }

        .chat-controls button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .chat-controls button:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: var(--bg-secondary);
        }

        .message {
            max-width: 85%;
            animation: messageSlide 0.3s ease;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
        }

        .message.bot {
            align-self: flex-start;
        }

        .message-content {
            padding: 15px 20px;
            border-radius: 20px;
            font-size: 14px;
            line-height: 1.5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .user .message-content {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            border-bottom-right-radius: 5px;
        }

        .bot .message-content {
            background: var(--chat-bot);
            color: var(--text-primary);
            border-bottom-left-radius: 5px;
            border: 1px solid var(--border-color);
        }

        .message-time {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 5px;
            margin-left: 10px;
        }

        .chat-input-area {
            padding: 20px;
            border-top: 2px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input-container input {
            flex: 1;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s;
        }

        .chat-input-container input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .chat-input-container input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .send-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s;
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .chat-warning {
            font-size: 11px;
            color: var(--danger);
            margin-top: 10px;
            text-align: center;
            display: none;
        }

        .chat-warning.show {
            display: block;
            animation: shake 0.3s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 5px;
            padding: 15px 20px;
            background: var(--chat-bot);
            border-radius: 20px;
            width: fit-content;
            border: 1px solid var(--border-color);
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: var(--accent-color);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-10px); opacity: 1; }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            padding: 40px;
            border-radius: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-header h3 {
            font-size: 24px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        /* Responsivo */
        @media (max-width: 1024px) {
            .profile-form {
                grid-template-columns: 1fr;
            }

            .chat-container {
                width: 350px;
                height: 500px;
            }
        }

        @media (max-width: 768px) {
            .nav-menu ul {
                overflow-x: auto;
                padding: 0 15px;
                gap: 0;
            }

            .nav-menu a {
                white-space: nowrap;
            }

            .profile-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .subjects-header {
                flex-direction: column;
                align-items: stretch;
            }

            .year-tabs {
                width: 100%;
            }

            .year-tab {
                flex: 1;
                text-align: center;
                padding: 12px 10px;
            }

            .chat-container {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
                height: 500px;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100px);
            }
        }
    </style>
</head>
<body>
    <!-- Seletor de Paleta -->
    <div class="palette-minimized" id="paletteMinimized" onclick="togglePaletteSelector()">
        🎨
    </div>

    <div class="palette-selector" id="paletteSelector">
        <div class="palette-header">
            <h4>🎨 Paleta de Cores</h4>
            <button class="palette-toggle" onclick="togglePaletteSelector()">✕</button>
        </div>
        <div class="palette-grid">
            <div class="palette-option default" onclick="changePalette('default', event)" title="Roxo/Índigo"></div>
            <div class="palette-option green" onclick="changePalette('green', event)" title="Verde/Esmeralda"></div>
            <div class="palette-option blue" onclick="changePalette('blue', event)" title="Azul/Oceano"></div>
            <div class="palette-option red" onclick="changePalette('red', event)" title="Vermelho/Coral"></div>
            <div class="palette-option orange" onclick="changePalette('orange', event)" title="Laranja/Âmbar"></div>
            <div class="palette-option pink" onclick="changePalette('pink', event)" title="Rosa/Roxo"></div>
            <div class="palette-option purple" onclick="changePalette('purple', event)" title="Roxo Escuro"></div>
            <div class="palette-option yellow" onclick="changePalette('yellow', event)" title="Amarelo/Dourado"></div>
            <div class="palette-option cyan" onclick="changePalette('cyan', event)" title="Ciano/Turquesa"></div>
            <div class="palette-option graphite" onclick="changePalette('graphite', event)" title="Grafite/Elegante"></div>
        </div>
    </div>

    <!-- Tela de Login/Cadastro -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="auth-logo">🤖 EdukAI</div>
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Entrar</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Criar Conta</button>
            </div>

            <!-- Formulário de Login -->
            <div class="auth-form active" id="loginForm">
                <h2>Bem-vindo de volta! 👋</h2>
                <p>Entre com seu ID de estudante</p>
                <div class="input-group">
                    <label>ID do Estudante</label>
                    <input type="text" id="loginId" placeholder="Ex: EDU-2024-001" autocomplete="off">
                </div>
                <button class="auth-btn" onclick="login()">Entrar no EdukAI</button>
            </div>

            <!-- Formulário de Cadastro -->
            <div class="auth-form" id="registerForm">
                <h2>Crie sua conta 🚀</h2>
                <p>Comece sua jornada de estudos</p>
                <div class="input-group">
                    <label>Nome Completo</label>
                    <input type="text" id="regName" placeholder="Seu nome">
                </div>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="regEmail" placeholder="seu@email.com">
                </div>
                <div class="input-group">
                    <label>ID do Estudante (único)</label>
                    <input type="text" id="regId" placeholder="Ex: EDU-2024-001">
                </div>
                <div class="input-group">
                    <label>Ano que está cursando</label>
                    <select id="regYear">
                        <option value="1">1° Ano do Ensino Médio</option>
                        <option value="2">2° Ano do Ensino Médio</option>
                        <option value="3">3° Ano do Ensino Médio</option>
                    </select>
                </div>
                <button class="auth-btn" onclick="register()">Criar minha conta</button>
            </div>
        </div>
    </div>

    <!-- Header Principal -->
    <header class="main-header">
        <div class="nav-container">
            <a href="#" class="logo">
                🤖 EdukAI
            </a>
            <div class="nav-right">
                <div class="user-info" onclick="showProfile()">
                    <div class="user-avatar" id="userAvatar"></div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Carregando...</div>
                        <div class="user-id" id="userId">ID: ---</div>
                    </div>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">
                    🌓
                </button>
            </div>
        </div>
    </header>

    <!-- Menu de Navegação -->
    <nav class="nav-menu">
        <ul>
            <li><a href="#" class="active" onclick="showSection('dashboard', this)">🏠 Dashboard</a></li>
            <li><a href="#" onclick="showSection('materias', this)">📚 Matérias</a></li>
            <li><a href="#" onclick="showSection('desempenho', this)">📊 Desempenho</a></li>
            <li><a href="#" onclick="showSection('simulados', this)">📝 Simulados</a></li>
            <li><a href="#" onclick="showSection('metas', this)">🎯 Metas</a></li>
            <li><a href="#" onclick="showFriends()">👥 Amigos</a></li>
            <li><a href="#" onclick="showRanking()">🏆 Ranking</a></li>
        </ul>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="main-content">
        <!-- Perfil do Estudante -->
        <div class="profile-section" id="profileSection">
            <div class="profile-header">
                <div class="profile-avatar-large" id="profileAvatar"></div>
                <div class="profile-info">
                    <h2 id="profileName"></h2>
                    <p id="profileEmail"></p>
                    <div class="profile-badges" id="profileBadges">
                        <!-- Badges serão inseridas via JS -->
                    </div>
                    <div class="stats-grid" style="margin-top: 20px; grid-template-columns: repeat(4, 1fr);">
                        <div class="stat-card" style="padding: 15px;">
                            <div class="stat-value" id="statsCompleted">0</div>
                            <div class="stat-label">Matérias</div>
                        </div>
                        <div class="stat-card" style="padding: 15px;">
                            <div class="stat-value" id="statsProgress">0%</div>
                            <div class="stat-label">Progresso</div>
                        </div>
                        <div class="stat-card" style="padding: 15px;">
                            <div class="stat-value" id="statsHours">0h</div>
                            <div class="stat-label">Estudadas</div>
                        </div>
                        <div class="stat-card" style="padding: 15px;">
                            <div class="stat-value" id="statsPoints">0</div>
                            <div class="stat-label">Pontos</div>
                        </div>
                    </div>
                </div>
            </div>

            <h3 style="margin-bottom: 20px;">🎖️ Minhas Conquistas</h3>
            <div class="badges-grid" id="userBadgesGrid"></div>

            <h3 style="margin: 40px 0 20px;">✏️ Editar Perfil</h3>
            <div class="profile-form">
                <div class="form-group">
                    <label>Nome</label>
                    <input type="text" id="editName">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="editEmail">
                </div>
                <div class="form-group">
                    <label>Ano</label>
                    <select id="editYear">
                        <option value="1">1° Ano</option>
                        <option value="2">2° Ano</option>
                        <option value="3">3° Ano</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Meta Diária (horas)</label>
                    <input type="number" id="editGoal" min="1" max="12" value="4">
                </div>
                <div class="form-group">
                    <label>ID do Estudante</label>
                    <input type="text" id="editId" disabled>
                </div>
            </div>
            <button class="complete-lesson-btn" onclick="saveProfile()" style="margin-top: 20px; width: auto;">💾 Salvar Alterações</button>
        </div>

        <!-- Seção de Amigos -->
        <div class="friends-container" id="friendsSection">
            <div class="friends-header">
                <h2>👥 Meus Amigos</h2>
                <div class="friends-tabs">
                    <button class="friend-tab active" onclick="switchFriendTab('list', this)">Lista de Amigos</button>
                    <button class="friend-tab" onclick="switchFriendTab('requests', this)">Solicitações</button>
                    <button class="friend-tab" onclick="switchFriendTab('search', this)">Buscar</button>
                </div>
            </div>

            <div id="friendsListTab" style="display: block;">
                <div class="friend-search">
                    <input type="text" id="friendSearchInput" placeholder="Buscar amigos...">
                    <button onclick="searchFriends()">Buscar</button>
                </div>
                <div class="friends-list" id="friendsList"></div>
            </div>

            <div id="friendRequestsTab" style="display: none;">
                <div class="friends-list" id="friendRequestsList"></div>
            </div>

            <div id="friendSearchTab" style="display: none;">
                <div class="friend-search">
                    <input type="text" id="globalSearchInput" placeholder="Digite o ID ou nome do estudante...">
                    <button onclick="globalSearch()">Buscar</button>
                </div>
                <div class="friends-list" id="searchResultsList"></div>
            </div>
        </div>

        <!-- Ranking -->
        <div class="ranking-container" id="rankingSection">
            <h2>🏆 Ranking de Estudos</h2>
            <div class="ranking-list" id="rankingList"></div>
        </div>

        <!-- Dashboard -->
        <div class="subjects-container" id="dashboardSection">
            <h2 style="margin-bottom: 30px;">🏠 Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">📚</div>
                    <div class="stat-value" id="dashboardCompleted">0</div>
                    <div class="stat-label">Matérias Concluídas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">📊</div>
                    <div class="stat-value" id="dashboardPercent">0%</div>
                    <div class="stat-label">Progresso Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🔥</div>
                    <div class="stat-value" id="dashboardStreak">0</div>
                    <div class="stat-label">Dias Seguidos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">⏱️</div>
                    <div class="stat-value" id="dashboardTime">0h</div>
                    <div class="stat-label">Tempo Estudado</div>
                </div>
            </div>

            <h3 style="margin: 40px 0 20px;">📊 Progresso por Área</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div style="background: var(--bg-primary); padding: 20px; border-radius: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Matemática</span>
                        <span id="mathProgress">0%</span>
                    </div>
                    <div class="subject-progress">
                        <div class="progress-bar" id="mathBar" style="width: 0%"></div>
                    </div>
                </div>
                <div style="background: var(--bg-primary); padding: 20px; border-radius: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Linguagens</span>
                        <span id="langProgress">0%</span>
                    </div>
                    <div class="subject-progress">
                        <div class="progress-bar" id="langBar" style="width: 0%"></div>
                    </div>
                </div>
                <div style="background: var(--bg-primary); padding: 20px; border-radius: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Humanas</span>
                        <span id="humanProgress">0%</span>
                    </div>
                    <div class="subject-progress">
                        <div class="progress-bar" id="humanBar" style="width: 0%"></div>
                    </div>
                </div>
                <div style="background: var(--bg-primary); padding: 20px; border-radius: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Natureza</span>
                        <span id="natureProgress">0%</span>
                    </div>
                    <div class="subject-progress">
                        <div class="progress-bar" id="natureBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Player Spotify no Dashboard -->
            <div class="spotify-player">
                <h3>🎧 Música para Estudar</h3>
                <select class="playlist-select" id="playlistSelect">
                    <option value="37i9dQZF1DX0FOF1IUWK1W">🎶 Top Brasil</option>
                    <option value="37i9dQZF1DX9FSYmdU9mbT">🇧🇷 MPB</option>
                    <option value="37i9dQZF1DWWY64wDtewQt">🔊 Phonk</option>
                    <option value="37i9dQZF1EQpj7X7UK8OOF">🎸 Rock</option>
                    <option value="3rPugprs5WtLcNH1VqXJDx">🔥 Trap 2026🇧🇷</option>
                    <option value="37i9dQZF1DWWQRwui0ExPn">🌙 Lo-fi beats</option>
                    <option value="37i9dQZF1DX186v583rmzp">🎤 90s Hip-Hop</option>
                    <option value="37i9dQZF1E8M7hCxGxmnna">🎺 Jazz</option>
                </select>
                <iframe 
                    id="spotifyFrame"
                    class="spotify-frame"
                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
                </iframe>
            </div>
        </div>

        <!-- Matérias -->
        <div class="subjects-container" id="materiasSection">
            <div class="subjects-header">
                <h2>📚 Todas as Matérias do ENEM</h2>
                <div class="year-tabs">
                    <button class="year-tab active" onclick="filterYear(1, this)">1° Ano</button>
                    <button class="year-tab" onclick="filterYear(2, this)">2° Ano</button>
                    <button class="year-tab" onclick="filterYear(3, this)">3° Ano</button>
                </div>
            </div>
            <div class="subjects-grid" id="subjectsGrid"></div>
            <div class="subject-content" id="subjectContent" style="display: none;">
                <div class="lesson-header">
                    <h3 class="lesson-title" id="currentSubjectTitle"></h3>
                </div>
                <div class="lesson-text" id="lessonContent"></div>
                <button class="complete-lesson-btn" id="completeSubjectBtn" onclick="completeCurrentSubject()">✓ Concluir Matéria</button>
            </div>
        </div>

        <!-- Desempenho -->
        <div class="subjects-container" id="desempenhoSection">
            <h2 style="margin-bottom: 30px;">📊 Desempenho nos Estudos</h2>
            <div style="height: 300px; background: var(--bg-primary); border-radius: 20px; padding: 30px; display: flex; align-items: flex-end; gap: 20px; justify-content: center;">
                <div style="flex: 1; text-align: center;">
                    <div style="height: 200px; background: linear-gradient(to top, var(--gradient-start), var(--gradient-end)); width: 50px; margin: 0 auto; border-radius: 10px 10px 0 0;"></div>
                    <p style="margin-top: 10px;">Matemática</p>
                </div>
                <div style="flex: 1; text-align: center;">
                    <div style="height: 180px; background: linear-gradient(to top, var(--gradient-start), var(--gradient-end)); width: 50px; margin: 0 auto; border-radius: 10px 10px 0 0;"></div>
                    <p style="margin-top: 10px;">Português</p>
                </div>
                <div style="flex: 1; text-align: center;">
                    <div style="height: 150px; background: linear-gradient(to top, var(--gradient-start), var(--gradient-end)); width: 50px; margin: 0 auto; border-radius: 10px 10px 0 0;"></div>
                    <p style="margin-top: 10px;">História</p>
                </div>
                <div style="flex: 1; text-align: center;">
                    <div style="height: 170px; background: linear-gradient(to top, var(--gradient-start), var(--gradient-end)); width: 50px; margin: 0 auto; border-radius: 10px 10px 0 0;"></div>
                    <p style="margin-top: 10px;">Geografia</p>
                </div>
                <div style="flex: 1; text-align: center;">
                    <div style="height: 140px; background: linear-gradient(to top, var(--gradient-start), var(--gradient-end)); width: 50px; margin: 0 auto; border-radius: 10px 10px 0 0;"></div>
                    <p style="margin-top: 10px;">Física</p>
                </div>
            </div>
        </div>

        <!-- Simulados -->
        <div class="subjects-container" id="simuladosSection">
            <h2 style="margin-bottom: 30px;">📝 Simulados ENEM</h2>
            <div class="subjects-grid">
                <div class="subject-card">
                    <div class="subject-icon">📝</div>
                    <div class="subject-title">Simulado Completo #1</div>
                    <div style="margin: 15px 0;">90 questões • 180 min</div>
                    <button class="complete-lesson-btn" style="width: 100%;">Iniciar</button>
                </div>
                <div class="subject-card">
                    <div class="subject-icon">📝</div>
                    <div class="subject-title">Simulado Completo #2</div>
                    <div style="margin: 15px 0;">90 questões • 180 min</div>
                    <button class="complete-lesson-btn" style="width: 100%;">Iniciar</button>
                </div>
                <div class="subject-card">
                    <div class="subject-icon">📝</div>
                    <div class="subject-title">Simulado Completo #3</div>
                    <div style="margin: 15px 0;">90 questões • 180 min</div>
                    <button class="complete-lesson-btn" style="width: 100%;">Iniciar</button>
                </div>
            </div>
        </div>

        <!-- Metas -->
        <div class="subjects-container" id="metasSection">
            <h2 style="margin-bottom: 30px;">🎯 Metas de Estudo</h2>
            <div class="subjects-grid">
                <div class="subject-card">
                    <div class="subject-icon">🎯</div>
                    <div class="subject-title">Meta Diária</div>
                    <div style="font-size: 24px; font-weight: bold; margin: 15px 0;" id="dailyGoalDisplay">4h</div>
                    <div class="subject-progress">
                        <div class="progress-bar" id="dailyProgress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="subject-card">
                    <div class="subject-icon">🎯</div>
                    <div class="subject-title">Meta Semanal</div>
                    <div style="font-size: 24px; font-weight: bold; margin: 15px 0;">5 matérias</div>
                    <div class="subject-progress">
                        <div class="progress-bar" id="weeklyProgress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="subject-card">
                    <div class="subject-icon">🎯</div>
                    <div class="subject-title">Meta do ENEM</div>
                    <div style="font-size: 24px; font-weight: bold; margin: 15px 0;">+800 pontos</div>
                    <div class="subject-progress">
                        <div class="progress-bar" style="width: 45%"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Chat DeepSeek -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-header" onclick="toggleChat(event)">
            <h3>
                <span>🤖</span> 
                <span>Professor Byte</span>
            </h3>
            <div class="chat-controls" onclick="event.stopPropagation()">
                <button onclick="toggleChat(event)">🗕</button>
            </div>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                <div class="message-content">
                    👋 Olá! Complete pelo menos 1 matéria para conversar comigo sobre qualquer assunto do ENEM!
                </div>
                <div class="message-time">Agora</div>
            </div>
        </div>
        <div class="chat-input-area">
            <div class="chat-input-container">
                <input type="text" id="chatInput" placeholder="Digite sua dúvida sobre o ENEM..." disabled>
                <button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled>➤</button>
            </div>
            <div class="chat-warning" id="chatWarning">
                ⚠️ Faça perguntas sobre matérias do ENEM (Matemática, Português, História, etc.)
            </div>
        </div>
    </div>

    <!-- Chat Privado -->
    <div class="private-chat" id="privateChat">
        <div class="private-chat-header" onclick="togglePrivateChat()">
            <h4 id="privateChatTitle">👤 Conversa</h4>
            <button onclick="closePrivateChat()">✕</button>
        </div>
        <div class="private-chat-messages" id="privateChatMessages"></div>
        <div class="private-chat-input">
            <input type="text" id="privateChatInput" placeholder="Digite sua mensagem...">
            <button onclick="sendPrivateMessage()">➤</button>
        </div>
    </div>

    <script>
        // ==================== CONFIGURAÇÃO DeepSeek AI ====================
        const DEEPSEEK_API_KEY = 'sk-c1f0034f48e54230b5eaffa6358daaa1';
        const DEEPSEEK_API_URL = 'https://api.deepseek.com/v1/chat/completions';

        // ==================== BANCO DE DADOS LOCAL ====================
        let users = JSON.parse(localStorage.getItem('users')) || {};
        let friendRequests = JSON.parse(localStorage.getItem('friendRequests')) || {};
        let privateMessages = JSON.parse(localStorage.getItem('privateMessages')) || {};
        let currentUser = null;
        let currentChatFriend = null;

        // ==================== SISTEMA DE BADGES ====================
        const badges = [
            { id: 'first_lesson', name: 'Primeiro Passo', icon: '🎓', description: 'Complete sua primeira matéria', type: 'bronze' },
            { id: 'streak_7', name: 'Foco Total', icon: '🔥', description: 'Estude por 7 dias seguidos', type: 'silver' },
            { id: 'streak_30', name: 'Mestre da Disciplina', icon: '⚡', description: 'Estude por 30 dias seguidos', type: 'gold' },
            { id: 'math_master', name: 'Gênio da Matemática', icon: '📐', description: 'Complete todas as matérias de Matemática', type: 'platinum' },
            { id: 'humanities_master', name: 'Mestre em Humanas', icon: '🏛️', description: 'Complete todas as matérias de Humanas', type: 'gold' },
            { id: 'nature_master', name: 'Cientista', icon: '🧬', description: 'Complete todas as matérias de Natureza', type: 'platinum' },
            { id: 'language_master', name: 'Poliglota', icon: '📝', description: 'Complete todas as matérias de Linguagens', type: 'gold' },
            { id: 'perfect_score', name: 'Nota Máxima', icon: '💯', description: 'Complete 50 matérias', type: 'platinum' },
            { id: 'study_hours_10', name: 'Dedicado', icon: '⏱️', description: 'Estude por 10 horas', type: 'bronze' },
            { id: 'study_hours_50', name: 'Viciado em Estudo', icon: '📚', description: 'Estude por 50 horas', type: 'silver' },
            { id: 'friend_5', name: 'Popular', icon: '👥', description: 'Tenha 5 amigos', type: 'bronze' },
            { id: 'friend_15', name: 'Influencer', icon: '🌟', description: 'Tenha 15 amigos', type: 'silver' },
            { id: 'friend_30', name: 'Celebridade', icon: '👑', description: 'Tenha 30 amigos', type: 'gold' }
        ];

        // ==================== MATÉRIAS DO ENEM ====================
        const subjects = [
            // 1° ANO - Matemática
            { id: 101, title: "Matemática - Conjuntos", icon: "📐", year: 1, category: "math", completed: false, content: `<h4>Conjuntos Numéricos</h4><p><strong>Naturais (ℕ):</strong> 0, 1, 2, 3, 4... (números positivos)</p><p><strong>Inteiros (ℤ):</strong> ... -3, -2, -1, 0, 1, 2, 3... (inclui negativos)</p><p><strong>Racionais (ℚ):</strong> números que podem ser escritos como fração (ex: 1/2, 0,5, 2)</p><p><strong>Irracionais (I):</strong> não podem ser escritos como fração (π, √2, e)</p><p><strong>Reais (ℝ):</strong> união de todos os conjuntos anteriores</p>` },
            { id: 102, title: "Matemática - Funções", icon: "📈", year: 1, category: "math", completed: false, content: `<h4>Função do 1° Grau</h4><p>f(x) = ax + b, onde a ≠ 0</p><p><strong>Coeficiente angular (a):</strong> inclinação da reta</p><p><strong>Coeficiente linear (b):</strong> ponto onde a reta cruza o eixo y</p><p><strong>Raiz da função:</strong> valor de x onde f(x) = 0 (ax + b = 0 → x = -b/a)</p>` },
            
            // 1° ANO - Português
            { id: 103, title: "Português - Classes Gramaticais", icon: "📝", year: 1, category: "lang", completed: false, content: `<h4>Classes de Palavras</h4><p><strong>Substantivo:</strong> nomeia seres (casa, amor, João)</p><p><strong>Artigo:</strong> acompanha o substantivo (o, a, um, uma)</p><p><strong>Adjetivo:</strong> caracteriza (bonito, inteligente)</p><p><strong>Numeral:</strong> quantidade/ordem (um, primeiro, dobro)</p><p><strong>Pronome:</strong> substitui/acompanha (eu, meu, este)</p><p><strong>Verbo:</strong> ação/estado (correr, ser, estar)</p><p><strong>Advérbio:</strong> modifica verbo/adjetivo (bem, muito, aqui)</p><p><strong>Preposição:</strong> liga palavras (a, de, para, com)</p><p><strong>Conjunção:</strong> liga orações (e, mas, porque)</p><p><strong>Interjeição:</strong> emoções (Ah!, Ufa!)</p>` },
            
            // 1° ANO - História
            { id: 104, title: "História - Pré-História", icon: "🏛️", year: 1, category: "human", completed: false, content: `<h4>Pré-História</h4><p><strong>Paleolítico:</strong> Nômades, caça/coleta, descoberta do fogo, pinturas rupestres</p><p><strong>Neolítico:</strong> Sedentarização, agricultura, domesticação de animais, primeiras vilas</p><p><strong>Idade dos Metais:</strong> Uso do cobre, bronze e ferro, desenvolvimento de ferramentas mais avançadas</p>` },
            
            // 1° ANO - Geografia
            { id: 105, title: "Geografia - Cartografia", icon: "🌍", year: 1, category: "human", completed: false, content: `<h4>Elementos do Mapa</h4><p><strong>Título:</strong> assunto do mapa</p><p><strong>Legenda:</strong> significado dos símbolos</p><p><strong>Escala:</strong> relação entre o real e a representação (1:100.000 = 1cm no mapa = 1km real)</p><p><strong>Orientação:</strong> rosa dos ventos (Norte, Sul, Leste, Oeste)</p><p><strong>Projeções:</strong> formas de representar a Terra no plano (Mercator, Peters, etc.)</p>` },
            
            // 1° ANO - Física
            { id: 106, title: "Física - Cinemática", icon: "⚡", year: 1, category: "nature", completed: false, content: `<h4>Movimento Uniforme (MU)</h4><p><strong>Velocidade constante:</strong> v = Δs/Δt</p><p><strong>Função horária:</strong> s = s₀ + v·t</p><p><strong>Movimento Uniformemente Variado (MUV):</strong> aceleração constante</p><p><strong>Equações:</strong> v = v₀ + at | s = s₀ + v₀t + at²/2 | v² = v₀² + 2aΔs</p>` },
            
            // 1° ANO - Química
            { id: 107, title: "Química - Átomos", icon: "⚛️", year: 1, category: "nature", completed: false, content: `<h4>Estrutura Atômica</h4><p><strong>Prótons:</strong> carga positiva, no núcleo</p><p><strong>Nêutrons:</strong> carga neutra, no núcleo</p><p><strong>Elétrons:</strong> carga negativa, na eletrosfera</p><p><strong>Número atômico (Z):</strong> quantidade de prótons</p><p><strong>Massa atômica (A):</strong> prótons + nêutrons</p><p><strong>Íons:</strong> cátion (+), ânion (-)</p>` },
            
            // 1° ANO - Biologia
            { id: 108, title: "Biologia - Células", icon: "🧬", year: 1, category: "nature", completed: false, content: `<h4>Tipos de Célula</h4><p><strong>Procariontes:</strong> sem núcleo definido (bactérias)</p><p><strong>Eucariontes:</strong> com núcleo definido (animais, plantas, fungos)</p><p><strong>Organelas:</strong> mitocôndrias (energia), ribossomos (proteínas), retículo endoplasmático, complexo de Golgi</p>` },
            
            // 1° ANO - Filosofia
            { id: 109, title: "Filosofia - Pré-socráticos", icon: "🤔", year: 1, category: "human", completed: false, content: `<h4>Filósofos da Natureza</h4><p><strong>Tales de Mileto:</strong> água como arché (princípio de tudo)</p><p><strong>Anaxímenes:</strong> ar como arché</p><p><strong>Heráclito:</strong> tudo flui, movimento constante ("Não se banha duas vezes no mesmo rio")</p><p><strong>Parmênides:</strong> ser é imutável, o movimento é ilusão</p><p><strong>Demócrito:</strong> teoria atomista (tudo é formado por átomos)</p>` },
            
            // 1° ANO - Sociologia
            { id: 110, title: "Sociologia - Introdução", icon: "👥", year: 1, category: "human", completed: false, content: `<h4>O que é Sociologia?</h4><p>Ciência que estuda a sociedade, as relações sociais e as instituições</p><p><strong>Auguste Comte:</strong> criador do termo Sociologia, positivismo</p><p><strong>Émile Durkheim:</strong> fatos sociais (coercitivos, exteriores, gerais)</p><p><strong>Max Weber:</strong> ação social (ação com sentido)</p><p><strong>Karl Marx:</strong> luta de classes, materialismo histórico</p>` },
            
            // 2° ANO - Matemática
            { id: 201, title: "Matemática - Geometria Plana", icon: "📐", year: 2, category: "math", completed: false, content: `<h4>Geometria Plana</h4><p><strong>Triângulos:</strong> soma dos ângulos internos = 180°</p><p><strong>Teorema de Pitágoras:</strong> a² = b² + c² (hipotenusa² = cateto² + cateto²)</p><p><strong>Áreas:</strong> quadrado (L²), retângulo (b·h), triângulo (b·h/2), círculo (πr²)</p><p><strong>Semelhança de triângulos:</strong> lados proporcionais, ângulos iguais</p>` },
            { id: 202, title: "Matemática - Trigonometria", icon: "📐", year: 2, category: "math", completed: false, content: `<h4>Razões Trigonométricas</h4><p><strong>Seno:</strong> cateto oposto / hipotenusa</p><p><strong>Cosseno:</strong> cateto adjacente / hipotenusa</p><p><strong>Tangente:</strong> cateto oposto / cateto adjacente</p><p><strong>Ângulos notáveis:</strong> 30° (1/2, √3/2, √3/3), 45° (√2/2, √2/2, 1), 60° (√3/2, 1/2, √3)</p>` },
            
            // 2° ANO - Português
            { id: 203, title: "Literatura - Romantismo", icon: "📚", year: 2, category: "lang", completed: false, content: `<h4>Romantismo no Brasil</h4><p><strong>1ª geração (1836-1852):</strong> indianismo, nacionalismo, exaltação da natureza (José de Alencar - "O Guarani")</p><p><strong>2ª geração (1853-1869):</strong> ultra-romantismo, mal do século, subjetivismo (Álvares de Azevedo - "Noite na Taverna")</p><p><strong>3ª geração (1870-1880):</strong> condoreirismo, poesia social, abolicionista (Castro Alves - "Navio Negreiro")</p>` },
            
            // 2° ANO - História
            { id: 204, title: "História - Brasil Colônia", icon: "🏛️", year: 2, category: "human", completed: false, content: `<h4>Período Colonial (1500-1822)</h4><p><strong>1500-1530:</strong> Pré-colonial, exploração do pau-brasil</p><p><strong>1530-1549:</strong> Capitanias Hereditárias</p><p><strong>1549-1763:</strong> Governo-Geral (Salvador)</p><p><strong>Ciclos econômicos:</strong> pau-brasil, açúcar (nordeste), ouro (Minas Gerais), café (vale do Paraíba)</p><p><strong>Entradas e Bandeiras:</strong> exploração do interior</p><p><strong>Quilombos:</strong> resistência negra (Quilombo dos Palmares)</p>` },
            
            // 2° ANO - Geografia
            { id: 205, title: "Geografia - Climas do Brasil", icon: "🌤️", year: 2, category: "human", completed: false, content: `<h4>Tipos de Clima no Brasil</h4><p><strong>Equatorial:</strong> quente e úmido (Amazônia) - temperaturas altas, chuvas abundantes</p><p><strong>Tropical:</strong> quente com estação seca (Centro-Oeste, Sudeste) - verão chuvoso, inverno seco</p><p><strong>Semiárido:</strong> quente e seco (Nordeste) - chuvas escassas e irregulares</p><p><strong>Subtropical:</strong> temperaturas mais baixas (Sul) - estações bem definidas, geadas</p><p><strong>Tropical Atlântico:</strong> litoral (influência da umidade do mar)</p>` },
            
            // 2° ANO - Física
            { id: 206, title: "Física - Termologia", icon: "🌡️", year: 2, category: "nature", completed: false, content: `<h4>Calor e Temperatura</h4><p><strong>Temperatura:</strong> grau de agitação das moléculas</p><p><strong>Calor:</strong> energia térmica em trânsito (flui do corpo mais quente para o mais frio)</p><p><strong>Escalas termométricas:</strong> Celsius, Fahrenheit, Kelvin</p><p><strong>Conversão:</strong> C/5 = (F-32)/9 = (K-273)/5</p><p><strong>Capacidade térmica:</strong> C = Q/ΔT</p><p><strong>Calor específico:</strong> c = C/m</p>` },
            
            // 2° ANO - Química
            { id: 207, title: "Química - Ligações", icon: "⚛️", year: 2, category: "nature", completed: false, content: `<h4>Ligações Químicas</h4><p><strong>Iônica:</strong> metal + ametal (transferência de elétrons) - Ex: NaCl (sal de cozinha)</p><p><strong>Covalente:</strong> ametal + ametal (compartilhamento) - Ex: H₂O, CO₂</p><p><strong>Metálica:</strong> metal + metal (nuvem de elétrons) - Ex: ligas metálicas</p><p><strong>Ligação de hidrogênio:</strong> tipo especial de ligação intermolecular (água)</p>` },
            
            // 2° ANO - Biologia
            { id: 208, title: "Biologia - Genética", icon: "🧬", year: 2, category: "nature", completed: false, content: `<h4>Leis de Mendel</h4><p><strong>1ª Lei (Lei da Segregação):</strong> cada característica é determinada por um par de fatores (genes) que se separam na formação dos gametas</p><p><strong>2ª Lei (Lei da Segregação Independente):</strong> os fatores para diferentes características se distribuem independentemente nos gametas</p><p><strong>Genótipo:</strong> constituição genética (ex: AA, Aa, aa)</p><p><strong>Fenótipo:</strong> característica observável (ex: olhos castanhos)</p>` },
            
            // 3° ANO - Matemática
            { id: 301, title: "Matemática - Estatística", icon: "📊", year: 3, category: "math", completed: false, content: `<h4>Medidas Estatísticas</h4><p><strong>Média aritmética:</strong> soma dos valores / número de elementos</p><p><strong>Mediana:</strong> valor central quando os dados estão ordenados</p><p><strong>Moda:</strong> valor que mais aparece</p><p><strong>Variância:</strong> medida de dispersão em relação à média</p><p><strong>Desvio padrão:</strong> raiz quadrada da variância</p>` },
            { id: 302, title: "Matemática - Probabilidade", icon: "🎲", year: 3, category: "math", completed: false, content: `<h4>Probabilidade</h4><p>P(A) = número de casos favoráveis / número de casos possíveis</p><p><strong>Exemplo:</strong> probabilidade de sair cara no lançamento de uma moeda = 1/2 = 0,5 = 50%</p><p><strong>Eventos independentes:</strong> P(A e B) = P(A) × P(B)</p><p><strong>Eventos mutuamente exclusivos:</strong> P(A ou B) = P(A) + P(B)</p>` },
            
            // 3° ANO - Português
            { id: 303, title: "Literatura - Modernismo", icon: "📚", year: 3, category: "lang", completed: false, content: `<h4>Modernismo no Brasil</h4><p><strong>1ª fase (1922-1930):</strong> Semana de Arte Moderna, ruptura com o passado, nacionalismo crítico (Mário de Andrade - "Macunaíma", Oswald de Andrade)</p><p><strong>2ª fase (1930-1945):</strong> poesia social, regionalismo nordestino (Graciliano Ramos - "Vidas Secas", Jorge Amado)</p><p><strong>3ª fase (1945-1978):</strong> prosa contemporânea, experimentalismo (Guimarães Rosa - "Grande Sertão: Veredas", Clarice Lispector)</p>` },
            
            // 3° ANO - História
            { id: 304, title: "História - Era Vargas", icon: "🏛️", year: 3, category: "human", completed: false, content: `<h4>Governo Vargas (1930-1945)</h4><p><strong>Governo Provisório (1930-1934):</strong> fechamento do Congresso, nomeação de interventores</p><p><strong>Governo Constitucional (1934-1937):</strong> Constituição de 1934, voto feminino, justiça do trabalho</p><p><strong>Estado Novo (1937-1945):</strong> ditadura, centralização, DIP (propaganda), CLT (1943)</p><p><strong>Realizações:</strong> Petrobras (1953), indústria de base, salário mínimo</p>` },
            
            // 3° ANO - Geografia
            { id: 305, title: "Geografia - Globalização", icon: "🌐", year: 3, category: "human", completed: false, content: `<h4>Globalização</h4><p>Processo de integração econômica, política e cultural mundial</p><p><strong>Características:</strong> fluxos de informação (internet), capitais (investimentos), mercadorias e pessoas</p><p><strong>Blocos econômicos:</strong> Mercosul, União Europeia, NAFTA, ASEAN</p><p><strong>Multinacionais:</strong> empresas que atuam em vários países</p><p><strong>Aldeia global:</strong> interconexão mundial</p>` },
            
            // 3° ANO - Física
            { id: 306, title: "Física - Eletricidade", icon: "⚡", year: 3, category: "nature", completed: false, content: `<h4>Lei de Ohm</h4><p>U = R · i</p><p><strong>U:</strong> tensão elétrica (Volts - V)</p><p><strong>R:</strong> resistência elétrica (Ohms - Ω)</p><p><strong>i:</strong> corrente elétrica (Amperes - A)</p><p><strong>Potência elétrica:</strong> P = U · i</p><p><strong>Circuitos:</strong> série (mesma corrente), paralelo (mesma tensão)</p>` },
            
            // 3° ANO - Química
            { id: 307, title: "Química - Orgânica", icon: "🧪", year: 3, category: "nature", completed: false, content: `<h4>Química Orgânica</h4><p><strong>Hidrocarbonetos:</strong> compostos apenas com C e H</p><p><strong>Alcanos:</strong> ligações simples (CₙH₂ₙ₊₂) - Ex: metano (CH₄)</p><p><strong>Alcenos:</strong> ligação dupla (CₙH₂ₙ) - Ex: eteno (C₂H₄)</p><p><strong>Alcinos:</strong> ligação tripla (CₙH₂ₙ₋₂) - Ex: etino (C₂H₂)</p><p><strong>Funções orgânicas:</strong> álcool, fenol, aldeído, cetona, ácido carboxílico, éter, éster, amina, amida</p>` },
            
            // 3° ANO - Biologia
            { id: 308, title: "Biologia - Ecologia", icon: "🌿", year: 3, category: "nature", completed: false, content: `<h4>Ecossistemas</h4><p><strong>População:</strong> indivíduos da mesma espécie em uma área</p><p><strong>Comunidade:</strong> diferentes populações interagindo</p><p><strong>Ecossistema:</strong> comunidade + fatores abióticos (água, solo, clima)</p><p><strong>Biosfera:</strong> conjunto de todos os ecossistemas da Terra</p><p><strong>Cadeia alimentar:</strong> produtores → consumidores → decompositores</p>` },
            
            // 3° ANO - Atualidades
            { id: 309, title: "Atualidades - Política", icon: "🏛️", year: 3, category: "human", completed: false, content: `<h4>Sistema Político Brasileiro</h4><p><strong>Três poderes:</strong> Executivo (governador/presidente), Legislativo (deputados/senadores), Judiciário (juízes)</p><p><strong>Presidencialismo:</strong> presidente é chefe de Estado e de governo</p><p><strong>Democracia representativa:</strong> votamos em representantes</p><p><strong>Partidos políticos:</strong> organizações que representam ideologias</p>` },
            { id: 310, title: "Atualidades - Meio Ambiente", icon: "🌱", year: 3, category: "nature", completed: false, content: `<h4>Questões Ambientais</h4><p><strong>Aquecimento global:</strong> aumento da temperatura média da Terra</p><p><strong>Efeito estufa:</strong> gases (CO₂, metano) retêm calor</p><p><strong>Desmatamento:</strong> perda de florestas (Amazônia)</p><p><strong>Poluição:</strong> ar, água, solo</p><p><strong>Sustentabilidade:</strong> desenvolvimento que atende às necessidades atuais sem comprometer o futuro</p>` }
        ];

        // ==================== FUNÇÕES DE AUTENTICAÇÃO ====================
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelector('.auth-tab').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        function generateStudentId() {
            return 'EDU-' + Math.floor(Math.random() * 1000).toString().padStart(3, '0') + '-' + 
                Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        }

        function register() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const id = document.getElementById('regId').value;
            const year = document.getElementById('regYear').value;

            if (!name || !email || !id) {
                alert('Preencha todos os campos!');
                return;
            }

            if (users[id]) {
                alert('ID já existe! Escolha outro.');
                return;
            }

            const newUser = {
                id: id,
                name: name,
                email: email,
                year: parseInt(year),
                completedSubjects: [],
                friends: [],
                badges: ['first_lesson'],
                points: 10,
                theme: 'light',
                createdAt: new Date().toISOString(),
                studyGoal: 4,
                streak: 1,
                lastAccess: new Date().toISOString(),
                studyHours: 0,
                online: true,
                lastSeen: new Date().toISOString()
            };

            users[id] = newUser;
            localStorage.setItem('users', JSON.stringify(users));
            currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));

            document.getElementById('authContainer').classList.add('hidden');
            updateUserInterface();
            renderSubjects();
            updateProgressBars();
            updateBadges();
        }

        function login() {
            const id = document.getElementById('loginId').value;

            if (!id) {
                alert('Digite seu ID!');
                return;
            }

            if (!users[id]) {
                alert('ID não encontrado! Crie uma conta primeiro.');
                return;
            }

            currentUser = users[id];
            currentUser.online = true;
            currentUser.lastSeen = new Date().toISOString();
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('users', JSON.stringify(users));

            document.getElementById('authContainer').classList.add('hidden');
            updateUserInterface();
            renderSubjects();
            checkChatUnlock();
            updateProgressBars();
            updateBadges();
            loadFriends();
        }

        function logout() {
            if (currentUser) {
                currentUser.online = false;
                currentUser.lastSeen = new Date().toISOString();
                users[currentUser.id] = currentUser;
                localStorage.setItem('users', JSON.stringify(users));
            }
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('authContainer').classList.remove('hidden');
        }

        // ==================== FUNÇÕES DE BADGES ====================
        function checkBadges() {
            if (!currentUser) return;
            
            const completedCount = currentUser.completedSubjects.length;
            const mathCompleted = subjects.filter(s => s.category === 'math' && currentUser.completedSubjects.includes(s.id)).length;
            const langCompleted = subjects.filter(s => s.category === 'lang' && currentUser.completedSubjects.includes(s.id)).length;
            const humanCompleted = subjects.filter(s => s.category === 'human' && currentUser.completedSubjects.includes(s.id)).length;
            const natureCompleted = subjects.filter(s => s.category === 'nature' && currentUser.completedSubjects.includes(s.id)).length;
            
            const mathTotal = subjects.filter(s => s.category === 'math').length;
            const langTotal = subjects.filter(s => s.category === 'lang').length;
            const humanTotal = subjects.filter(s => s.category === 'human').length;
            const natureTotal = subjects.filter(s => s.category === 'nature').length;
            
            const friendCount = currentUser.friends ? currentUser.friends.length : 0;
            const studyHours = currentUser.studyHours || 0;
            const streak = currentUser.streak || 0;
            
            const newBadges = [];
            
            if (completedCount >= 1 && !currentUser.badges.includes('first_lesson')) newBadges.push('first_lesson');
            if (streak >= 7 && !currentUser.badges.includes('streak_7')) newBadges.push('streak_7');
            if (streak >= 30 && !currentUser.badges.includes('streak_30')) newBadges.push('streak_30');
            if (mathCompleted === mathTotal && mathTotal > 0 && !currentUser.badges.includes('math_master')) newBadges.push('math_master');
            if (langCompleted === langTotal && langTotal > 0 && !currentUser.badges.includes('language_master')) newBadges.push('language_master');
            if (humanCompleted === humanTotal && humanTotal > 0 && !currentUser.badges.includes('humanities_master')) newBadges.push('humanities_master');
            if (natureCompleted === natureTotal && natureTotal > 0 && !currentUser.badges.includes('nature_master')) newBadges.push('nature_master');
            if (completedCount >= 50 && !currentUser.badges.includes('perfect_score')) newBadges.push('perfect_score');
            if (studyHours >= 10 && !currentUser.badges.includes('study_hours_10')) newBadges.push('study_hours_10');
            if (studyHours >= 50 && !currentUser.badges.includes('study_hours_50')) newBadges.push('study_hours_50');
            if (friendCount >= 5 && !currentUser.badges.includes('friend_5')) newBadges.push('friend_5');
            if (friendCount >= 15 && !currentUser.badges.includes('friend_15')) newBadges.push('friend_15');
            if (friendCount >= 30 && !currentUser.badges.includes('friend_30')) newBadges.push('friend_30');
            
            if (newBadges.length > 0) {
                currentUser.badges = [...(currentUser.badges || []), ...newBadges];
                currentUser.points = (currentUser.points || 0) + (newBadges.length * 50);
                users[currentUser.id] = currentUser;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                newBadges.forEach(badgeId => {
                    const badge = badges.find(b => b.id === badgeId);
                    if (badge) {
                        alert(`🎉 Parabéns! Você desbloqueou a conquista: ${badge.name}! +50 pontos!`);
                    }
                });
            }
        }

        function updateBadges() {
            if (!currentUser) return;
            
            const profileBadges = document.getElementById('profileBadges');
            profileBadges.innerHTML = '';
            
            (currentUser.badges || []).forEach(badgeId => {
                const badge = badges.find(b => b.id === badgeId);
                if (badge) {
                    const badgeEl = document.createElement('span');
                    badgeEl.className = `badge ${badge.type}`;
                    badgeEl.innerHTML = `${badge.icon} ${badge.name}`;
                    profileBadges.appendChild(badgeEl);
                }
            });
            
            const userBadgesGrid = document.getElementById('userBadgesGrid');
            userBadgesGrid.innerHTML = '';
            
            badges.forEach(badge => {
                const isUnlocked = currentUser.badges && currentUser.badges.includes(badge.id);
                const card = document.createElement('div');
                card.className = `badge-card ${isUnlocked ? 'unlocked' : ''}`;
                card.innerHTML = `
                    <div class="badge-icon">${badge.icon}</div>
                    <div class="badge-title">${badge.name}</div>
                    <div class="badge-description">${badge.description}</div>
                    <div style="margin-top: 10px; font-size: 11px;">${isUnlocked ? '✓ Desbloqueado' : '🔒 Bloqueado'}</div>
                `;
                userBadgesGrid.appendChild(card);
            });
        }

        // ==================== FUNÇÕES DE AMIGOS ====================
        function showFriends() {
            document.querySelectorAll('.profile-section, .subjects-container, .friends-container, .ranking-container').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById('friendsSection').style.display = 'block';
            document.querySelectorAll('.nav-menu a').forEach(a => a.classList.remove('active'));
            document.querySelector('.nav-menu a[onclick*="showFriends"]').classList.add('active');
            loadFriends();
        }

        function switchFriendTab(tab, element) {
            document.querySelectorAll('.friend-tab').forEach(t => t.classList.remove('active'));
            element.classList.add('active');
            
            document.getElementById('friendsListTab').style.display = tab === 'list' ? 'block' : 'none';
            document.getElementById('friendRequestsTab').style.display = tab === 'requests' ? 'block' : 'none';
            document.getElementById('friendSearchTab').style.display = tab === 'search' ? 'block' : 'none';
            
            if (tab === 'requests') loadFriendRequests();
            if (tab === 'list') loadFriends();
        }

        function loadFriends() {
            if (!currentUser) return;
            
            const friendsList = document.getElementById('friendsList');
            friendsList.innerHTML = '';
            
            (currentUser.friends || []).forEach(friendId => {
                const friend = users[friendId];
                if (friend) {
                    const friendCard = createFriendCard(friend);
                    friendsList.appendChild(friendCard);
                }
            });
        }

        function loadFriendRequests() {
            const requestsList = document.getElementById('friendRequestsList');
            requestsList.innerHTML = '';
            
            const requests = friendRequests[currentUser.id] || [];
            requests.forEach(requestId => {
                const requester = users[requestId];
                if (requester) {
                    const card = document.createElement('div');
                    card.className = 'friend-card';
                    card.innerHTML = `
                        <div class="friend-avatar ${requester.online ? 'online' : ''}">${requester.name.charAt(0)}</div>
                        <div class="friend-info">
                            <div class="friend-name">${requester.name}</div>
                            <div class="friend-status">ID: ${requester.id} • ${requester.online ? '🟢 Online' : '⚫ Offline'}</div>
                        </div>
                        <div class="friend-actions">
                            <button class="friend-action-btn accept" onclick="acceptFriendRequest('${requester.id}')">✓ Aceitar</button>
                            <button class="friend-action-btn reject" onclick="rejectFriendRequest('${requester.id}')">✕ Rejeitar</button>
                        </div>
                    `;
                    requestsList.appendChild(card);
                }
            });
        }

        function searchFriends() {
            const query = document.getElementById('friendSearchInput').value.toLowerCase();
            const friendsList = document.getElementById('friendsList');
            friendsList.innerHTML = '';
            
            (currentUser.friends || []).forEach(friendId => {
                const friend = users[friendId];
                if (friend && (friend.name.toLowerCase().includes(query) || friend.id.toLowerCase().includes(query))) {
                    const friendCard = createFriendCard(friend);
                    friendsList.appendChild(friendCard);
                }
            });
        }

        function globalSearch() {
            const query = document.getElementById('globalSearchInput').value.toLowerCase();
            const resultsList = document.getElementById('searchResultsList');
            resultsList.innerHTML = '';
            
            Object.values(users).forEach(user => {
                if (user.id !== currentUser.id && 
                    !(currentUser.friends || []).includes(user.id) &&
                    (user.name.toLowerCase().includes(query) || user.id.toLowerCase().includes(query))) {
                    
                    const card = document.createElement('div');
                    card.className = 'friend-card';
                    card.innerHTML = `
                        <div class="friend-avatar ${user.online ? 'online' : ''}">${user.name.charAt(0)}</div>
                        <div class="friend-info">
                            <div class="friend-name">${user.name}</div>
                            <div class="friend-status">ID: ${user.id} • ${user.online ? '🟢 Online' : '⚫ Offline'}</div>
                            <div style="font-size: 12px;">Pontos: ${user.points || 0} • Matérias: ${user.completedSubjects.length}</div>
                        </div>
                        <div class="friend-actions">
                            <button class="friend-action-btn accept" onclick="sendFriendRequest('${user.id}')">➕ Adicionar</button>
                        </div>
                    `;
                    resultsList.appendChild(card);
                }
            });
        }

        function sendFriendRequest(friendId) {
            if (!friendRequests[friendId]) {
                friendRequests[friendId] = [];
            }
            if (!friendRequests[friendId].includes(currentUser.id)) {
                friendRequests[friendId].push(currentUser.id);
                localStorage.setItem('friendRequests', JSON.stringify(friendRequests));
                alert('Solicitação de amizade enviada!');
            }
        }

        function acceptFriendRequest(requesterId) {
            if (!currentUser.friends) currentUser.friends = [];
            if (!users[requesterId].friends) users[requesterId].friends = [];
            
            currentUser.friends.push(requesterId);
            users[requesterId].friends.push(currentUser.id);
            
            friendRequests[currentUser.id] = (friendRequests[currentUser.id] || []).filter(id => id !== requesterId);
            
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('friendRequests', JSON.stringify(friendRequests));
            
            loadFriendRequests();
            updateBadges();
            checkBadges();
            alert('Amizade aceita!');
        }

        function rejectFriendRequest(requesterId) {
            friendRequests[currentUser.id] = (friendRequests[currentUser.id] || []).filter(id => id !== requesterId);
            localStorage.setItem('friendRequests', JSON.stringify(friendRequests));
            loadFriendRequests();
        }

        function createFriendCard(friend) {
            const card = document.createElement('div');
            card.className = 'friend-card';
            card.onclick = () => openPrivateChat(friend);
            card.innerHTML = `
                <div class="friend-avatar ${friend.online ? 'online' : ''}">${friend.name.charAt(0)}</div>
                <div class="friend-info">
                    <div class="friend-name">${friend.name}</div>
                    <div class="friend-status">
                        ID: ${friend.id} • ${friend.online ? '🟢 Online' : '⚫ Offline'} • 
                        Matérias: ${friend.completedSubjects.length}
                    </div>
                </div>
                <div class="friend-points">${friend.points || 0} pts</div>
            `;
            return card;
        }

        // ==================== FUNÇÕES DE CHAT PRIVADO ====================
        function openPrivateChat(friend) {
            currentChatFriend = friend;
            document.getElementById('privateChat').classList.add('show');
            document.getElementById('privateChatTitle').innerHTML = `👤 ${friend.name}`;
            loadPrivateMessages(friend.id);
        }

        function closePrivateChat() {
            document.getElementById('privateChat').classList.remove('show');
            currentChatFriend = null;
        }

        function togglePrivateChat() {
            // Função para minimizar/maximizar chat
        }

        function loadPrivateMessages(friendId) {
            const messagesDiv = document.getElementById('privateChatMessages');
            messagesDiv.innerHTML = '';
            
            const chatId = [currentUser.id, friendId].sort().join('_');
            const messages = privateMessages[chatId] || [];
            
            messages.forEach(msg => {
                const isSent = msg.sender === currentUser.id;
                const msgDiv = document.createElement('div');
                msgDiv.className = `private-message ${isSent ? 'sent' : 'received'}`;
                msgDiv.innerHTML = `
                    <div class="private-message-content">${msg.text}</div>
                    <div class="message-time">${new Date(msg.timestamp).toLocaleTimeString()}</div>
                `;
                messagesDiv.appendChild(msgDiv);
            });
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function sendPrivateMessage() {
            const input = document.getElementById('privateChatInput');
            const text = input.value.trim();
            
            if (!text || !currentChatFriend) return;
            
            const chatId = [currentUser.id, currentChatFriend.id].sort().join('_');
            if (!privateMessages[chatId]) privateMessages[chatId] = [];
            
            privateMessages[chatId].push({
                sender: currentUser.id,
                text: text,
                timestamp: new Date().toISOString()
            });
            
            localStorage.setItem('privateMessages', JSON.stringify(privateMessages));
            
            input.value = '';
            loadPrivateMessages(currentChatFriend.id);
        }

        // ==================== FUNÇÕES DE RANKING ====================
        function showRanking() {
            document.querySelectorAll('.profile-section, .subjects-container, .friends-container, .ranking-container').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById('rankingSection').style.display = 'block';
            document.querySelectorAll('.nav-menu a').forEach(a => a.classList.remove('active'));
            document.querySelector('.nav-menu a[onclick*="showRanking"]').classList.add('active');
            loadRanking();
        }

        function loadRanking() {
            const rankingList = document.getElementById('rankingList');
            rankingList.innerHTML = '';
            
            const sortedUsers = Object.values(users)
                .sort((a, b) => (b.points || 0) - (a.points || 0))
                .slice(0, 50);
            
            sortedUsers.forEach((user, index) => {
                const rankClass = index === 0 ? 'top-1' : index === 1 ? 'top-2' : index === 2 ? 'top-3' : '';
                const item = document.createElement('div');
                item.className = `ranking-item ${rankClass}`;
                
                const badgeIcons = (user.badges || []).slice(0, 3).map(badgeId => {
                    const badge = badges.find(b => b.id === badgeId);
                    return badge ? `<span class="ranking-badge" title="${badge.name}">${badge.icon}</span>` : '';
                }).join('');
                
                item.innerHTML = `
                    <div class="ranking-position">#${index + 1}</div>
                    <div class="ranking-avatar">${user.name.charAt(0)}</div>
                    <div class="ranking-info">
                        <div class="ranking-name">${user.name}</div>
                        <div class="ranking-points">${user.points || 0} pontos • ${user.completedSubjects.length} matérias</div>
                    </div>
                    <div class="ranking-badges">${badgeIcons}</div>
                `;
                rankingList.appendChild(item);
            });
        }

        // ==================== FUNÇÕES DE INTERFACE ====================
        function updateUserInterface() {
            if (!currentUser) return;

            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userId').textContent = `ID: ${currentUser.id}`;
            
            const avatar = document.getElementById('userAvatar');
            avatar.textContent = currentUser.name.charAt(0).toUpperCase();
            
            document.getElementById('profileAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profileEmail').textContent = currentUser.email;
            
            // Formulário de edição
            document.getElementById('editName').value = currentUser.name;
            document.getElementById('editEmail').value = currentUser.email;
            document.getElementById('editYear').value = currentUser.year;
            document.getElementById('editGoal').value = currentUser.studyGoal || 4;
            document.getElementById('editId').value = currentUser.id;
            
            updateStats();
            updateBadges();
        }

        function updateStats() {
            if (!currentUser) return;
            
            const completed = currentUser.completedSubjects.length;
            const total = subjects.length;
            const percent = Math.round((completed / total) * 100);
            const points = currentUser.points || 0;
            
            document.getElementById('statsCompleted').textContent = completed;
            document.getElementById('statsProgress').textContent = percent + '%';
            document.getElementById('statsHours').textContent = (currentUser.studyHours || 0) + 'h';
            document.getElementById('statsPoints').textContent = points;
            
            // Dashboard
            document.getElementById('dashboardCompleted').textContent = completed;
            document.getElementById('dashboardPercent').textContent = percent + '%';
            document.getElementById('dashboardStreak').textContent = currentUser.streak || 0;
            document.getElementById('dashboardTime').textContent = (currentUser.studyHours || 0) + 'h';
            
            // Metas
            document.getElementById('dailyGoalDisplay').textContent = (currentUser.studyGoal || 4) + 'h';
        }

        function updateProgressBars() {
            if (!currentUser) return;

            // Calcular progresso por área
            const mathSubjects = subjects.filter(s => s.category === 'math');
            const langSubjects = subjects.filter(s => s.category === 'lang');
            const humanSubjects = subjects.filter(s => s.category === 'human');
            const natureSubjects = subjects.filter(s => s.category === 'nature');

            const mathCompleted = mathSubjects.filter(s => currentUser.completedSubjects.includes(s.id)).length;
            const langCompleted = langSubjects.filter(s => currentUser.completedSubjects.includes(s.id)).length;
            const humanCompleted = humanSubjects.filter(s => currentUser.completedSubjects.includes(s.id)).length;
            const natureCompleted = natureSubjects.filter(s => currentUser.completedSubjects.includes(s.id)).length;

            const mathPercent = Math.round((mathCompleted / mathSubjects.length) * 100);
            const langPercent = Math.round((langCompleted / langSubjects.length) * 100);
            const humanPercent = Math.round((humanCompleted / humanSubjects.length) * 100);
            const naturePercent = Math.round((natureCompleted / natureSubjects.length) * 100);

            document.getElementById('mathProgress').textContent = mathPercent + '%';
            document.getElementById('mathBar').style.width = mathPercent + '%';
            
            document.getElementById('langProgress').textContent = langPercent + '%';
            document.getElementById('langBar').style.width = langPercent + '%';
            
            document.getElementById('humanProgress').textContent = humanPercent + '%';
            document.getElementById('humanBar').style.width = humanPercent + '%';
            
            document.getElementById('natureProgress').textContent = naturePercent + '%';
            document.getElementById('natureBar').style.width = naturePercent + '%';
        }

        function showProfile() {
            document.querySelectorAll('.profile-section, .subjects-container, .friends-container, .ranking-container').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById('profileSection').style.display = 'block';
            document.querySelectorAll('.nav-menu a').forEach(a => a.classList.remove('active'));
            updateUserInterface();
        }

        function showSection(section, element) {
            document.querySelectorAll('.profile-section, .subjects-container, .friends-container, .ranking-container').forEach(el => {
                el.style.display = 'none';
            });
            
            document.getElementById(section + 'Section').style.display = 'block';
            
            document.querySelectorAll('.nav-menu a').forEach(a => a.classList.remove('active'));
            element.classList.add('active');
        }

        function saveProfile() {
            if (!currentUser) return;
            
            currentUser.name = document.getElementById('editName').value;
            currentUser.email = document.getElementById('editEmail').value;
            currentUser.year = parseInt(document.getElementById('editYear').value);
            currentUser.studyGoal = parseInt(document.getElementById('editGoal').value);
            
            users[currentUser.id] = currentUser;
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            updateUserInterface();
            alert('Perfil atualizado com sucesso!');
        }

        // ==================== FUNÇÕES DAS MATÉRIAS ====================
        function renderSubjects() {
            const grid = document.getElementById('subjectsGrid');
            grid.innerHTML = '';

            filterYear(1, document.querySelector('.year-tab'));
        }

        function filterYear(year, element) {
            document.querySelectorAll('.year-tab').forEach(t => t.classList.remove('active'));
            element.classList.add('active');

            const grid = document.getElementById('subjectsGrid');
            grid.innerHTML = '';

            subjects.filter(s => s.year === year).forEach(subject => {
                const isCompleted = currentUser?.completedSubjects?.includes(subject.id) || false;
                
                const card = document.createElement('div');
                card.className = `subject-card ${isCompleted ? 'completed' : ''}`;
                card.onclick = () => openSubject(subject.id);
                card.innerHTML = `
                    <div class="subject-icon">${subject.icon}</div>
                    <div class="subject-title">${subject.title}</div>
                    <div class="subject-progress">
                        <div class="progress-bar" style="width: ${isCompleted ? '100%' : '0%'}"></div>
                    </div>
                    <div class="subject-status">
                        <span>${isCompleted ? 'Concluído' : 'Não iniciado'}</span>
                        ${isCompleted ? '<span class="completed-badge">✓ Concluído</span>' : ''}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        let currentSubjectId = null;

        function openSubject(id) {
            const subject = subjects.find(s => s.id === id);
            if (!subject) return;

            currentSubjectId = id;
            
            document.getElementById('subjectContent').style.display = 'block';
            document.getElementById('currentSubjectTitle').textContent = subject.title;
            document.getElementById('lessonContent').innerHTML = subject.content;
            
            const isCompleted = currentUser?.completedSubjects?.includes(id) || false;
            const btn = document.getElementById('completeSubjectBtn');
            if (isCompleted) {
                btn.disabled = true;
                btn.textContent = '✓ Matéria já concluída';
            } else {
                btn.disabled = false;
                btn.textContent = '✓ Concluir Matéria';
            }
        }

        function completeCurrentSubject() {
            if (!currentUser || !currentSubjectId) return;
            
            if (!currentUser.completedSubjects.includes(currentSubjectId)) {
                currentUser.completedSubjects.push(currentSubjectId);
                currentUser.points = (currentUser.points || 0) + 10;
                currentUser.studyHours = (currentUser.studyHours || 0) + 1;
                
                users[currentUser.id] = currentUser;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                const activeYear = document.querySelector('.year-tab.active');
                const year = activeYear ? parseInt(activeYear.textContent) : 1;
                filterYear(year, activeYear);
                
                updateStats();
                updateProgressBars();
                checkChatUnlock();
                checkBadges();
                updateBadges();
                
                document.getElementById('completeSubjectBtn').disabled = true;
                document.getElementById('completeSubjectBtn').textContent = '✓ Matéria já concluída';
                
                alert('🎉 Parabéns! Matéria concluída! +10 pontos! Continue assim!');
            }
        }

        // ==================== FUNÇÕES DO CHAT DEEPSEEK ====================
        let chatUnlocked = false;

        function checkChatUnlock() {
            if (!currentUser) return;
            
            chatUnlocked = currentUser.completedSubjects.length >= 1;
            
            if (chatUnlocked) {
                document.getElementById('chatInput').disabled = false;
                document.getElementById('sendBtn').disabled = false;
                
                const messages = document.getElementById('chatMessages');
                if (messages.children.length === 1) {
                    addBotMessage('✅ Parabéns! Agora você pode fazer perguntas sobre qualquer matéria do ENEM! Estou aqui para ajudar! 📚');
                }
            }
        }

        function toggleChat(event) {
            if (event) event.stopPropagation();
            document.getElementById('chatContainer').classList.toggle('minimized');
        }

        function addBotMessage(text) {
            const messages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString('pt-br', { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-content">${text}</div>
                <div class="message-time">${timeStr}</div>
            `;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        function addUserMessage(text) {
            const messages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString('pt-br', { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-content">${text}</div>
                <div class="message-time">${timeStr}</div>
            `;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        function showTypingIndicator() {
            const messages = document.getElementById('chatMessages');
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.id = 'typingIndicator';
            indicator.innerHTML = '<span></span><span></span><span></span>';
            messages.appendChild(indicator);
            messages.scrollTop = messages.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || !chatUnlocked) return;

            // Palavras-chave de matérias escolares
            const schoolKeywords = [
                'matemática', 'português', 'história', 'geografia', 'física', 'química', 
                'biologia', 'filosofia', 'sociologia', 'literatura', 'gramática', 'redação',
                'enem', 'vestibular', 'função', 'equação', 'trigonometria', 'geometria',
                'probabilidade', 'estatística', 'célula', 'átomo', 'genética', 'ecologia',
                'globalização', 'clima', 'relevo', 'romantismo', 'modernismo', 'vargas',
                'república', 'colônia', 'império', 'áfrica', 'europa', 'américa', 'brasil',
                'segunda guerra', 'primeira guerra', 'revolução industrial', 'capitalismo',
                'socialismo', 'mitocôndria', 'fotossíntese', 'respiração celular', 'tabela periódica',
                'ligações químicas', 'cinemática', 'dinâmica', 'termodinâmica', 'eletricidade',
                'ondulatória', 'óptica', 'álgebra', 'cálculo', 'porcentagem', 'juros'
            ];
            
            const isSchoolRelated = schoolKeywords.some(keyword => 
                message.toLowerCase().includes(keyword.toLowerCase())
            );
            
            if (!isSchoolRelated) {
                document.getElementById('chatWarning').classList.add('show');
                setTimeout(() => document.getElementById('chatWarning').classList.remove('show'), 3000);
                return;
            }

            document.getElementById('chatWarning').classList.remove('show');
            
            addUserMessage(message);
            input.value = '';
            showTypingIndicator();

            try {
                const prompt = `Você é um professor especializado no ENEM (Exame Nacional do Ensino Médio). Responda à seguinte pergunta de forma educativa, clara e didática, focando no conteúdo do Ensino Médio. Use linguagem acessível, exemplos práticos e, se possível, relacione com o que costuma cair no ENEM. Pergunta: ${message}`;

                const response = await fetch(DEEPSEEK_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: 'Você é um professor especializado em ENEM, responda sempre em português de forma educativa e didática.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });

                if (!response.ok) {
                    throw new Error(`Erro na API: ${response.status}`);
                }

                const data = await response.json();
                const botResponse = data.choices[0].message.content;

                removeTypingIndicator();
                addBotMessage(botResponse);

            } catch (error) {
                console.error('Erro detalhado:', error);
                removeTypingIndicator();
                
                const fallbackResponses = [
                    "Desculpe, estou com dificuldades técnicas. Mas lembre-se: no ENEM, é importante interpretar bem os textos e gráficos!",
                    "Essa é uma ótima pergunta! Recomendo revisar os conceitos básicos da matéria e praticar com exercícios anteriores do ENEM.",
                    "Vamos pensar juntos: o que você já sabe sobre esse assunto? Comece pelo básico e depois aprofunde.",
                    "No ENEM, esse tema costuma cair com interpretação de texto e análise de situações-problema. Pratique bastante!"
                ];
                addBotMessage(fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)]);
            }
        }

        // ==================== FUNÇÕES DO SPOTIFY ====================
        const playlistSelect = document.getElementById('playlistSelect');
        const spotifyFrame = document.getElementById('spotifyFrame');

        function updatePlaylist(id) {
            spotifyFrame.src = `https://open.spotify.com/embed/playlist/${id}?utm_source=generator`;
            localStorage.setItem('selectedPlaylist', id);
        }

        // Carregar playlist salva
        const savedPlaylist = localStorage.getItem('selectedPlaylist');
        if (savedPlaylist) {
            playlistSelect.value = savedPlaylist;
            updatePlaylist(savedPlaylist);
        } else {
            updatePlaylist(playlistSelect.value);
        }

        playlistSelect.addEventListener('change', () => {
            updatePlaylist(playlistSelect.value);
        });

        // ==================== FUNÇÕES DE TEMA ====================
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            document.getElementById('themeBtn').textContent = newTheme === 'dark' ? '☀️' : '🌙';
            
            if (currentUser) {
                currentUser.theme = newTheme;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
        }

        // ==================== FUNÇÕES DE PALETA DE CORES ====================
        function togglePaletteSelector() {
            const selector = document.getElementById('paletteSelector');
            const minimized = document.getElementById('paletteMinimized');
            
            if (selector.style.display === 'none' || selector.style.display === '') {
                selector.style.display = 'block';
                minimized.style.display = 'none';
            } else {
                selector.style.display = 'none';
                minimized.style.display = 'flex';
            }
        }

        function changePalette(palette, event) {
            // Remove todas as paletas
            document.documentElement.removeAttribute('data-palette');
            
            // Aplica a nova paleta se não for default
            if (palette !== 'default') {
                document.documentElement.setAttribute('data-palette', palette);
            }
            
            // Salva a preferência
            localStorage.setItem('selectedPalette', palette);
            
            // Atualiza a classe active nas opções
            document.querySelectorAll('.palette-option').forEach(opt => {
                opt.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Feedback visual
            showNotification(`Paleta alterada para ${getPaletteName(palette)}`);
        }

        function getPaletteName(palette) {
            const names = {
                'default': 'Roxo/Índigo',
                'green': 'Verde/Esmeralda',
                'blue': 'Azul/Oceano',
                'red': 'Vermelho/Coral',
                'orange': 'Laranja/Âmbar',
                'pink': 'Rosa/Roxo',
                'purple': 'Roxo Escuro',
                'yellow': 'Amarelo/Dourado',
                'cyan': 'Ciano/Turquesa',
                'graphite': 'Grafite/Elegante'
            };
            return names[palette] || 'Padrão';
        }

        function showNotification(message) {
            // Cria um elemento de notificação temporário
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--accent-color);
                color: white;
                padding: 15px 25px;
                border-radius: 12px;
                box-shadow: var(--shadow);
                z-index: 2000;
                animation: slideIn 0.3s ease;
                font-weight: 500;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // ==================== INICIALIZAÇÃO ====================
        window.onload = function() {
            // Carregar paleta salva
            const savedPalette = localStorage.getItem('selectedPalette');
            if (savedPalette && savedPalette !== 'default') {
                document.documentElement.setAttribute('data-palette', savedPalette);
                
                // Marcar a opção como ativa
                setTimeout(() => {
                    const activeOption = document.querySelector(`.palette-option.${savedPalette}`);
                    if (activeOption) activeOption.classList.add('active');
                }, 100);
            } else {
                document.querySelector('.palette-option.default').classList.add('active');
            }

            // Verificar se há usuário logado
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                currentUser.online = true;
                currentUser.lastSeen = new Date().toISOString();
                document.getElementById('authContainer').classList.add('hidden');
                updateUserInterface();
                renderSubjects();
                checkChatUnlock();
                updateProgressBars();
                updateBadges();
            }

            // Carregar tema salvo
            if (currentUser?.theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('themeBtn').textContent = '☀️';
            }

            // Inicialmente mostrar dashboard
            document.querySelectorAll('.subjects-container').forEach(el => el.style.display = 'none');
            document.getElementById('dashboardSection').style.display = 'block';
        };

        // Atualizar status offline quando fechar a página
        window.onbeforeunload = function() {
            if (currentUser) {
                currentUser.online = false;
                currentUser.lastSeen = new Date().toISOString();
                users[currentUser.id] = currentUser;
                localStorage.setItem('users', JSON.stringify(users));
            }
        };
    </script>
</body>
</html>